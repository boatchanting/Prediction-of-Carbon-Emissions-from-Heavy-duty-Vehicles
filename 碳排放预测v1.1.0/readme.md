# 碳排放预测v1.1.0

## 1. 环境配置

在运行本项目之前，请确保已经正确配置了开发环境。推荐使用虚拟环境来隔离项目依赖，并确保与项目的依赖包版本一致。

### 1.1 创建虚拟环境

您可以使用 `venv` 或 `conda` 来创建虚拟环境。以下是使用 `venv` 创建虚拟环境的示例：

```bash
# 在项目根目录下创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate

# macOS/Linux:
source venv/bin/activate
```

### 1.2 安装依赖包

项目的依赖包已经列在 `requirements.txt` 文件中。请在激活虚拟环境后，运行以下命令来安装所有依赖包：

```bash
pip install -r requirements.txt
```

如果上述方法无法正常运行，也可以手动安装以下依赖包：

```bash
pip install torch # 建议更改为适配你的CUDA版本的torch，默认安装的torch是cpu版本，链接(https://pytorch.org/)
pip install PyQt5
pip install numpy
pip install pandas
pip install seaborn
pip install matplotlib
```

### 1.3 验证安装

安装完成后，您可以通过运行以下命令来验证所有依赖包是否成功安装：

```python
import torch
import PyQt5
import numpy
import pandas
import seaborn
import matplotlib
```

如果没有错误提示，说明环境配置正确，您可以开始运行项目代码。

## 2. 启动程序 
在完成所有依赖包的配置之后，您可以通过以下步骤启动程序： 
1. 确保已激活虚拟环境（参见第1.1节）。 
2. 双击项目目录下的 `双击我！.bat` 文件。
3.  `双击我！.bat` 文件已经配置好所有启动程序所需的命令，您只需双击即可轻松启动项目。

## 3. 数据准备

在运行程序之前，请确保您已经准备好数据文件。数据文件应该包含以下内容：

- 列名为`speed`的车辆运行过程中每1s采样的时序数据，单位km/h。
- 示例数据在`model`文件夹中，文件名为`speed example.xlsx`。

请确保数据文件格式正确，并且列名与程序中的预期一致。

---

## 4. 使用说明

程序启动后，您将看到一个图形用户界面（GUI）。在该GUI中，您可以进行以下操作：
### 4.1 碳排放预测
1. **模型导入**：
   - 点击“选择模型路径”按钮，选择已经训练好的模型文件（通常是 `.pth` 格式的文件）。
   - 该模型文件将被加载到程序中，用于对输入数据进行预测。

2. **数据导入**：
   - 点击“选择数据路径”按钮，选择包含需要预测数据的 Excel 文件（`.xlsx` 格式）。
   - 程序将使用该数据进行碳排放预测。

3. **输出路径设置**：
   - 在“选择输出文件夹”部分，您可以选择预测结果的输出路径。
     - **与输入数据路径相同**：输出结果将保存到与输入数据相同的文件夹中。
     - **桌面**：输出结果将保存到桌面。
     - **自定义路径**：您可以选择自定义路径作为输出文件夹。选择后，系统会自动更新输出路径显示。

4. **文件名设置**：
   - 在“输出文件名”栏中，您可以修改输出结果文件的名称。默认情况下，程序会根据输入数据文件名自动生成一个合适的输出文件名。

5. **执行预测**：
   - 点击“执行预测”按钮，程序将加载模型并对输入数据进行预测。
   - 预测完成后，结果将保存为 Excel 文件，并显示在指定的输出路径中。

6. **预测结果**：
   - 预测的结果将包括输入的速度数据 `speed(km/h)` 和相应的碳排放预测值 `emission(kg/s)`。
   - 结果将被自动保存为 Excel 文件，文件名和路径依据您的设置确定。

### 4.2 碳排放预测结果可视化

1. **切换界面**：
   - 将界面切换至'数据可视化'界面。

2. **数据文件路径设置**：
   - **选择数据文件**：
     - 点击“浏览”按钮，打开文件选择对话框。
     - 选择包含数据的 Excel 文件（`.xlsx` 格式）。选择后，文件路径将显示在“数据文件路径”输入框中。

3. **绘图风格选择**：
   - **设置绘图风格**：
     - 从“绘图风格”下拉菜单中选择一个风格，如“白色网格”、“黑色网格”、“黑色”或“刻度”。选择后，图表的样式将根据所选风格进行调整。

4. **平滑曲线设置**：
   - **显示平滑曲线**：
     - 勾选或取消勾选“平滑曲线”复选框，选择是否在图表中显示平滑曲线。
   - **设置平滑因子**：
     - 使用“平滑因子”滑动条调整平滑因子。平滑因子的值将在滑动条旁边的标签中显示。默认值为0.05，范围从0.01到0.30。

5. **绘图类型选择**：
   - **选择绘图类型**：
     - 从“绘图类型”下拉菜单中选择绘图类型，如“排放”、“车速”、“车速累积”或“排放累积”。根据选择的类型，图表将显示不同的数据内容。

6. **线条颜色设置**：
     - 从“线条颜色”下拉菜单中选择一种颜色。如果选择“自定义”，点击“选择自定义线条颜色”按钮打开颜色选择对话框，选择所需的自定义颜色。

7. **平滑曲线颜色设置**：
    - 从“平滑曲线颜色”下拉菜单中选择一种颜色。如果选择“自定义”，点击“选择自定义平滑曲线颜色”按钮打开颜色选择对话框，选择所需的自定义颜色。

8. **绘制数据**：
   - 点击“绘制数据”按钮，应用程序将根据设置的参数绘制数据图表。图表将显示在应用程序的右侧区域。

9. **保存图表**：
    - 点击“保存图片”按钮，打开文件保存对话框。
    - 选择保存路径和文件名，将图表保存为 PNG 格式的图片（`.png`）。

## 5. 退出应用程序：

关闭应用程序窗口终止脚本执行，退出应用程序。
